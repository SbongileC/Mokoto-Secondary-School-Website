<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - Mokoto High</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: url('school.jpg.jpg') no-repeat center center/cover;
      color: #333;
    }
    header {
      background: rgba(255, 255, 255, 0.9);
      padding: 20px;
      text-align: center;
      position: relative;
    }
    header img { width: 120px; }
    #logoutBtn {
      position: absolute;
      top: 20px;
      right: 30px;
      padding: 8px 15px;
      background: #dc3545;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    nav {
      background: rgba(255, 255, 255, 0.9);
      display: flex;
      gap: 15px;
      padding: 15px 30px;
      flex-wrap: wrap;
    }
    nav a {
      text-decoration: none;
      color: #333;
      font-weight: bold;
    }
    nav a:hover { color: #0056b3; }
    .section {
      padding: 20px;
      margin: 20px;
      background: rgba(255,255,255,0.95);
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 10px; text-align: left; }
    th { background: #f2f2f2; }
    button {
      padding: 6px 12px;
      margin: 2px;
      border-radius: 5px;
      border: none;
      background: #28a745;
      color: #fff;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover { background: #218838; }
    input, select {
      padding: 8px;
      margin: 5px 0;
      width: 100%;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .add-student-form {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>

<header>
  <img src="logo.jpg" alt="School Logo">
  <h1>Admin Dashboard</h1>
  <button id="logoutBtn">Logout</button>
</header>

<nav>
  <a href="#students">Manage Students</a>
  <a href="#messages">View Contact Messages</a>
  <a href="#testimonials">Manage Testimonials</a>
</nav>

<!-- Add New Student -->
<section class="section" id="addStudentSection">
  <h2>Add New Student</h2>
  <form id="addStudentForm" class="add-student-form">
    <input type="text" id="studentId" placeholder="Student ID" required>
    <input type="text" id="fullName" placeholder="Full Name" required>
    <input type="email" id="email" placeholder="Email" required>
    <select id="grade" required>
      <option value="">Select Grade</option>
      <option value="Grade 8">Grade 8</option>
      <option value="Grade 9">Grade 9</option>
      <option value="Grade 10">Grade 10</option>
      <option value="Grade 11">Grade 11</option>
      <option value="Grade 12">Grade 12</option>
    </select>
    <button type="submit">Add Student</button>
  </form>
</section>

<!-- Manage Students -->
<section id="students" class="section">
  <h2>Registered Students</h2>
  <table id="studentsTable">
    <thead>
      <tr>
        <th>Student ID</th>
        <th>Full Name</th>
        <th>Email</th>
        <th>Grade</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<!-- Contact Messages -->
<section id="messages" class="section">
  <h2>Contact Messages</h2>
  <table id="messagesTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Message</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<!-- Testimonials -->
<section id="testimonials" class="section">
  <h2>Student Testimonials</h2>
  <table id="testimonialsTable">
    <thead>
      <tr>
        <th>Student Name</th>
        <th>Testimonial</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, onValue, set, push } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";
  import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBUHlayR0u74ayIoHZY83Z3QII7D-1oECc",
    authDomain: "mokoto-high-school.firebaseapp.com",
    databaseURL: "https://mokoto-high-school-default-rtdb.firebaseio.com",
    projectId: "mokoto-high-school",
    storageBucket: "mokoto-high-school.firebasestorage.app",
    messagingSenderId: "32189864631",
    appId: "1:32189864631:web:d4aa5f46f4f87caa0c4b32",
    measurementId: "G-XNGBEK9CVL"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth();

  // Logout
  document.getElementById('logoutBtn').addEventListener('click', () => {
    signOut(auth).then(() => {
      alert('Logged out successfully!');
      window.location.href = "Login.html";
    }).catch(err => console.error(err));
  });

  // Add New Student
  const addStudentForm = document.getElementById('addStudentForm');
  addStudentForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const id = document.getElementById('studentId').value.trim();
    const name = document.getElementById('fullName').value.trim();
    const email = document.getElementById('email').value.trim();
    const grade = document.getElementById('grade').value;

    if(id && name && email && grade){
      set(ref(db, `students/${id}`), {
        studentId: id,
        fullName: name,
        email: email,
        grade: grade
      }).then(() => {
        alert('Student added successfully!');
        addStudentForm.reset();
      }).catch(err => console.error(err));
    }
  });

  // Load Students
  const studentsTable = document.getElementById('studentsTable').querySelector('tbody');
  const studentsRef = ref(db, 'students');
  onValue(studentsRef, snapshot => {
    studentsTable.innerHTML = '';
    snapshot.forEach(child => {
      const student = child.val();
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${student.studentId}</td>
        <td>${student.fullName}</td>
        <td>${student.email}</td>
        <td>${student.grade}</td>
        <td>
          <button class="deleteBtn">Delete</button>
        </td>
      `;
      studentsTable.appendChild(tr);

      tr.querySelector('.deleteBtn').addEventListener('click', () => {
        if(confirm('Are you sure you want to delete this student?')){
          set(ref(db, `students/${child.key}`), null)
            .then(() => alert('Student deleted!'))
            .catch(err => console.error(err));
        }
      });
    });
  });

  // Load Contact Messages
  const messagesTable = document.getElementById('messagesTable').querySelector('tbody');
  const messagesRef = ref(db, 'contactMessages');
  onValue(messagesRef, snapshot => {
    messagesTable.innerHTML = '';
    snapshot.forEach(child => {
      const msg = child.val();
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${msg.name}</td><td>${msg.email}</td><td>${msg.message}</td>`;
      messagesTable.appendChild(tr);
    });
  });

  // Load Testimonials
  const testimonialsTable = document.getElementById('testimonialsTable').querySelector('tbody');
  const testimonialsRef = ref(db, 'testimonials');
  onValue(testimonialsRef, snapshot => {
    testimonialsTable.innerHTML = '';
    snapshot.forEach(child => {
      const t = child.val();
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${t.studentName}</td>
        <td>${t.message}</td>
        <td><button class="deleteBtn">Delete</button></td>
      `;
      testimonialsTable.appendChild(tr);

      tr.querySelector('.deleteBtn').addEventListener('click', () => {
        if(confirm('Delete this testimonial?')){
          set(ref(db, `testimonials/${child.key}`), null)
            .then(() => alert('Testimonial deleted!'))
            .catch(err => console.error(err));
        }
      });
    });
  });

</script>

</body>
</html>
