<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Upload Study Materials - Mokoto High</title>
<style>
body { font-family: Arial; background: #f4f4f4; padding: 20px; }
input, button { padding: 8px; margin: 5px; }
.material-list { margin-top: 20px; }
.material-item { background: white; padding: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
a { color: #0056b3; text-decoration: none; }
a:hover { text-decoration: underline; }
</style>
</head>
<body>

<h1>Upload Study Material</h1>
<input type="text" id="materialTitle" placeholder="Material Title">
<input type="text" id="materialLink" placeholder="Link (URL)">
<button id="uploadBtn">Upload</button>

<div class="material-list" id="materialList"></div>
<div><a href="TeacherDashboard.html">Back to Dashboard</a></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getDatabase, ref, push, set, get, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBUHlayR0u74ayIoHZY83Z3QII7D-1oECc",
  authDomain: "mokoto-high-school.firebaseapp.com",
  databaseURL: "https://mokoto-high-school-default-rtdb.firebaseio.com",
  projectId: "mokoto-high-school",
  storageBucket: "mokoto-high-school.firebasestorage.app",
  messagingSenderId: "32189864631",
  appId: "1:32189864631:web:d4aa5f46f4f87caa0c4b32"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

let teacherKey;

// Check if user is logged in and is a teacher
onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = "Login.html";
    return;
  }

  const email = user.email.toLowerCase();
  const teacherQuery = query(ref(db, "teachers"), orderByChild("email"), equalTo(email));
  const teacherSnap = await get(teacherQuery);

  if (!teacherSnap.exists()) {
    await signOut(auth);
    alert("Access denied. You are not a teacher.");
    window.location.href = "Login.html";
    return;
  }

  // Get teacher key
  teacherKey = Object.keys(teacherSnap.val())[0];
  loadMaterials();
});

// Upload material
const uploadBtn = document.getElementById("uploadBtn");
uploadBtn.addEventListener("click", async () => {
  const title = document.getElementById("materialTitle").value.trim();
  const link = document.getElementById("materialLink").value.trim();
  if (!title || !link) return alert("Enter both title and link");

  const matRef = ref(db, `teachers/${teacherKey}/materials`);
  const newRef = push(matRef);
  await set(newRef, { title, link });

  document.getElementById("materialTitle").value = "";
  document.getElementById("materialLink").value = "";
  loadMaterials();
});

// Load materials
async function loadMaterials() {
  const matList = document.getElementById("materialList");
  matList.innerHTML = "";
  const snap = await get(ref(db, `teachers/${teacherKey}/materials`));
  if (snap.exists()) {
    const materials = snap.val();
    for (const id in materials) {
      const div = document.createElement("div");
      div.className = "material-item";
      div.innerHTML = `<strong>${materials[id].title}</strong> - <a href="${materials[id].link}" target="_blank">View</a>`;
      matList.appendChild(div);
    }
  }
}
</script>

</body>
</html>
