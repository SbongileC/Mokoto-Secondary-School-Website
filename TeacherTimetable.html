<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Timetable - Mokoto High</title>
<style>
body{font-family:Arial;background:#f4f4f4;padding:20px;}
table{width:100%;border-collapse:collapse;margin-top:20px;}
th,td{border:1px solid #ccc;padding:10px;text-align:center;}
input{width:100px;}
button{margin-top:10px;padding:8px;}
</style>
</head>
<body>
<h1>My Timetable</h1>
<table id="timetableTable">
<thead>
<tr>
<th>Day</th>
<th>8:00-9:00</th>
<th>9:00-10:00</th>
<th>10:00-11:00</th>
<th>11:00-12:00</th>
</tr>
</thead>
<tbody></tbody>
</table>
<button id="saveBtn">Save Timetable</button>
<div><a href="TeacherDashboard.html">Back to Dashboard</a></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getDatabase, ref, get, set, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBUHlayR0u74ayIoHZY83Z3QII7D-1oECc",
  authDomain: "mokoto-high-school.firebaseapp.com",
  databaseURL: "https://mokoto-high-school-default-rtdb.firebaseio.com",
  projectId: "mokoto-high-school",
  storageBucket: "mokoto-high-school.firebasestorage.app",
  messagingSenderId: "32189864631",
  appId: "1:32189864631:web:d4aa5f46f4f87caa0c4b32"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);
let teacherKey;

const DAYS = ["Monday","Tuesday","Wednesday","Thursday","Friday"];
const HOURS = ["8:00-9:00","9:00-10:00","10:00-11:00","11:00-12:00"];

onAuthStateChanged(auth, async(user)=>{
  if(!user){window.location.href="Login.html"; return;}
  const email = user.email.toLowerCase();
  const snap = await get(query(ref(db,"teachers"),orderByChild("email"),equalTo(email)));
  if(!snap.exists()){await signOut(auth); alert("Access denied."); window.location.href="Login.html"; return;}
  teacherKey = Object.keys(snap.val())[0];
  loadTimetable();
});

async function loadTimetable(){
  const tbody = document.querySelector("#timetableTable tbody");
  tbody.innerHTML="";
  const snap = await get(ref(db, `teachers/${teacherKey}/timetable`));
  const timetable = snap.exists()? snap.val(): {};
  for(const day of DAYS){
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${day}</td>` + HOURS.map(h=>`<td><input type="text" data-day="${day}" data-hour="${h}" value="${timetable[day]?.[h]||''}"></td>`).join("");
    tbody.appendChild(tr);
  }
}

document.getElementById("saveBtn").addEventListener("click", async()=>{
  const tbody = document.querySelector("#timetableTable tbody");
  const timetable = {};
  tbody.querySelectorAll("tr").forEach(tr=>{
    const day = tr.children[0].textContent;
    timetable[day] = {};
    Array.from(tr.children).slice(1).forEach(td=>{
      const input = td.querySelector("input");
      timetable[day][input.dataset.hour] = input.value;
    });
  });
  await set(ref(db, `teachers/${teacherKey}/timetable`), timetable);
  alert("Timetable saved!");
});
</script>
</body>
</html>
